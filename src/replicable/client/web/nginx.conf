server {
  listen 80;
  server_name _;
  root /usr/share/nginx/html;
  index index.html;

  add_header X-Frame-Options SAMEORIGIN;
  add_header X-Content-Type-Options nosniff;
  add_header Referrer-Policy no-referrer-when-downgrade;
  add_header Cross-Origin-Opener-Policy same-origin;

  location / {
    try_files $uri /index.html;
  }

  # Reverse proxy API
  # Keep the '/api' prefix when forwarding so upstream FastAPI sees '/api/v1/...'
  # With 'location /api/' and 'proxy_pass .../api/', nginx replaces the matched
  # prefix with '/api/' instead of '/' (which was causing 404s at '/v1/...').
  location /api/ {
    proxy_pass http://replicable-api:8000/api/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
